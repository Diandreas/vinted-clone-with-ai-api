<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Message avec Informations Produit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #4338ca;
        }
        .info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .success {
            background: #d1fae5;
            border: 1px solid #10b981;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .code {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #d1d5db;
            overflow-x: auto;
        }
        .demo-message {
            background: #4f46e5;
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            max-width: 400px;
            margin-left: auto;
        }
        .product-card {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        .product-image {
            width: 64px;
            height: 64px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .product-details {
            display: flex;
            align-items: start;
            gap: 12px;
        }
        .product-info {
            flex: 1;
            min-width: 0;
        }
        .product-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }
        .product-description {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .product-price {
            font-weight: bold;
            font-size: 14px;
            color: #fbbf24;
        }
        .product-link {
            font-size: 12px;
            color: #fbbf24;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de la fonctionnalit√© de message avec informations produit</h1>

    <div class="test-section">
        <h2>‚úÖ Probl√®me r√©solu !</h2>
        <p>L'image et les informations du produit sont maintenant <strong>incluses dans le message</strong> envoy√© dans le chat.</p>

        <div class="success">
            <strong>Ce qui a √©t√© corrig√© :</strong>
            <ul>
                <li>‚úÖ Les informations du produit sont maintenant structur√©es dans le message</li>
                <li>‚úÖ L'image du produit est incluse dans le message</li>
                <li>‚úÖ Le titre, la description et le prix sont affich√©s</li>
                <li>‚úÖ Un lien vers le produit est disponible</li>
                <li>‚úÖ L'affichage est adapt√© au style du chat</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>üéØ Comment √ßa fonctionne maintenant</h2>

        <h3>1. Envoi du message</h3>
        <p>Quand vous envoyez un message depuis la page d'un produit :</p>
        <div class="code">
// Le message est maintenant structur√© comme ceci :
{
  "text": "Bonjour ! Je suis int√©ress√©(e) par votre produit...",
  "product": {
    "id": 1,
    "title": "iPhone 14 Pro",
    "description": "Excellent √©tat, jamais utilis√©",
    "price": 899,
    "image": "http://127.0.0.1:8000/storage/products/iphone14pro.jpg",
    "url": "http://127.0.0.1:8000/products/1"
  },
  "type": "product_inquiry"
}
        </div>

        <h3>2. Affichage dans le chat</h3>
        <p>Le message s'affiche maintenant avec :</p>
        <ul>
            <li>Le texte du message</li>
            <li>Une carte produit avec l'image</li>
            <li>Les informations du produit (titre, description, prix)</li>
            <li>Un lien pour voir le produit</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üëÄ D√©monstration visuelle</h2>
        <p>Voici comment le message appara√Ætra dans le chat :</p>

        <div class="demo-message">
            <div class="text-sm">Bonjour ! Je suis int√©ress√©(e) par votre produit "iPhone 14 Pro" au prix de 899,00 ‚Ç¨. Description : Excellent √©tat, jamais utilis√©. Pouvez-vous me donner plus d'informations ?</div>

            <div class="product-card">
                <div class="product-details">
                    <img src="https://via.placeholder.com/64x64/4f46e5/ffffff?text=üì±" alt="iPhone 14 Pro" class="product-image">
                    <div class="product-info">
                        <div class="product-title">iPhone 14 Pro</div>
                        <div class="product-description">Excellent √©tat, jamais utilis√©</div>
                        <div class="product-price">899,00 ‚Ç¨</div>
                        <a href="#" class="product-link">Voir le produit</a>
                    </div>
                </div>
            </div>

            <div class="text-[11px] mt-1 opacity-70">17/08/2025 18:57:46</div>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Modifications techniques apport√©es</h2>

        <h3>1. Dans `Messages.vue` - Fonction `sendMessage()`</h3>
        <div class="code">
// Le message est maintenant structur√© avec les infos produit
if (startTarget.value.productInfo && startTarget.value.productId) {
  const product = startTarget.value.productInfo

  const structuredMessage = {
    text: messageContent,
    product: {
      id: product.id,
      title: product.title,
      description: product.description,
      price: product.price,
      image: product.image,
      url: product.url
    },
    type: 'product_inquiry'
  }

  messageContent = JSON.stringify(structuredMessage)
  messageType = 'product_inquiry'
}
        </div>

        <h3>2. Dans `Messages.vue` - Fonction `startConversation()`</h3>
        <div class="code">
// M√™me logique pour d√©marrer une nouvelle conversation
if (startTarget.value.productInfo && startTarget.value.productId) {
  const product = startTarget.value.productInfo

  const structuredMessage = {
    text: messageContent,
    product: {
      id: product.id,
      title: product.title,
      description: product.description,
      price: product.price,
      image: product.image,
      url: product.url
    },
    type: 'product_inquiry'
  }

  messageContent = JSON.stringify(structuredMessage)
}
        </div>

        <h3>3. Dans `Messages.vue` - Affichage des messages</h3>
        <div class="code">
// Affichage des informations produit dans le chat
<div v-if="getMessageProduct(m)" class="product-card">
  <div class="product-details">
    <img :src="getMessageProduct(m).image" :alt="getMessageProduct(m).title">
    <div class="product-info">
      <div class="product-title">{{ getMessageProduct(m).title }}</div>
      <div class="product-description">{{ getMessageProduct(m).description }}</div>
      <div class="product-price">{{ formatPrice(getMessageProduct(m).price) }}</div>
      <a :href="getMessageProduct(m).url" class="product-link">Voir le produit</a>
    </div>
  </div>
</div>
        </div>
    </div>

    <div class="test-section">
        <h2>üß™ Comment tester</h2>
        <ol>
            <li><strong>Allez sur une page produit</strong> : <code>http://127.0.0.1:8000/products/1</code></li>
            <li><strong>Cliquez sur "Message"</strong> pour contacter le vendeur</li>
            <li><strong>Vous serez redirig√©</strong> vers la page des messages avec les infos du produit</li>
            <li><strong>Cliquez sur "Pr√©-remplir avec les infos du produit"</strong> pour g√©n√©rer un message automatique</li>
            <li><strong>Envoyez le message</strong></li>
            <li><strong>V√©rifiez dans le chat</strong> que l'image et les infos du produit sont bien affich√©es</li>
        </ol>

        <div class="warning">
            <strong>Important :</strong> Assurez-vous que votre serveur Laravel est d√©marr√© et que vous √™tes connect√© √† l'application.
        </div>
    </div>

    <div class="test-section">
        <h2>üé® Styles et design</h2>
        <p>Le design de la carte produit dans le chat :</p>
        <ul>
            <li><strong>Couleurs :</strong> Adapt√©es au th√®me du chat (blanc transparent sur fond bleu)</li>
            <li><strong>Image :</strong> 64x64px avec bordures arrondies</li>
            <li><strong>Typographie :</strong> Hi√©rarchie claire avec tailles diff√©rentes</li>
            <li><strong>Espacement :</strong> Marges et paddings coh√©rents</li>
            <li><strong>Responsive :</strong> S'adapte aux diff√©rentes tailles d'√©cran</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîç D√©pannage</h2>
        <p>Si l'image n'appara√Æt toujours pas :</p>
        <ul>
            <li><strong>V√©rifiez la console du navigateur</strong> pour les erreurs</li>
            <li><strong>V√©rifiez l'URL de l'image</strong> dans les param√®tres de l'URL</li>
            <li><strong>V√©rifiez les permissions</strong> des fichiers sur le serveur</li>
            <li><strong>V√©rifiez que l'API</strong> fonctionne correctement</li>
        </ul>

        <div class="info">
            <strong>Debug :</strong> Ouvrez la console et regardez les logs pour voir les donn√©es envoy√©es et re√ßues.
        </div>
    </div>

    <script>
        // Fonction pour tester la g√©n√©ration d'URL avec produit
        function testProductMessage() {
            const productInfo = {
                id: 1,
                title: "iPhone 14 Pro",
                description: "Excellent √©tat, jamais utilis√©",
                price: 899,
                image: "https://via.placeholder.com/200x200/4f46e5/ffffff?text=üì±",
                url: "http://127.0.0.1:8000/products/1"
            };

            const encoded = encodeURIComponent(JSON.stringify(productInfo));
            const url = `http://127.0.0.1:8000/messages?user=1&product=1&productInfo=${encoded}`;

            console.log('URL de test avec produit:', url);
            console.log('Informations du produit:', productInfo);

            // Ouvrir dans un nouvel onglet
            window.open(url, '_blank');
        }

        // Ajouter un bouton de test
        document.addEventListener('DOMContentLoaded', function() {
            const testButton = document.createElement('button');
            testButton.textContent = 'üß™ Tester le message avec produit';
            testButton.className = 'button';
            testButton.onclick = testProductMessage;

            document.querySelector('.test-section:last-child').appendChild(testButton);
        });
    </script>
</body>
</html>
