<!DOCTYPE html>
<html>
<head>
    <title>Test Wallet API</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Test de l'API Wallet</h1>
    
    <div id="status"></div>
    
    <h2>1. Récupérer le solde</h2>
    <button onclick="testBalance()">Tester Balance</button>
    <div id="balance-result"></div>
    
    <h2>2. Tester recharge (avec simulation)</h2>
    <button onclick="testTopUp()">Tester Recharge</button>
    <div id="topup-result"></div>
    
    <script>
        // Configuration
        const API_BASE = 'http://127.0.0.1:8000/api/v1';
        
        // Token d'authentification - remplacer par un vrai token
        const AUTH_TOKEN = 'YOUR_AUTH_TOKEN_HERE';
        
        // Configuration axios
        axios.defaults.baseURL = API_BASE;
        axios.defaults.headers.common['Authorization'] = `Bearer ${AUTH_TOKEN}`;
        axios.defaults.headers.common['Content-Type'] = 'application/json';
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div style="color: ${type === 'error' ? 'red' : 'green'}; margin: 10px 0;">${message}</div>`;
        }
        
        async function testBalance() {
            const resultDiv = document.getElementById('balance-result');
            
            try {
                updateStatus('Test du solde en cours...', 'info');
                
                const response = await axios.get('/wallet/balance');
                
                resultDiv.innerHTML = `
                    <div style="background: #f0f8ff; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <h4>✅ Succès!</h4>
                        <p><strong>Solde:</strong> ${response.data.data.balance_formatted}</p>
                        <p><strong>Dernière MAJ:</strong> ${response.data.data.last_updated || 'N/A'}</p>
                        <pre>${JSON.stringify(response.data, null, 2)}</pre>
                    </div>
                `;
                
                updateStatus('Test du solde réussi!', 'success');
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #ffe6e6; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <h4>❌ Erreur!</h4>
                        <p><strong>Status:</strong> ${error.response?.status || 'Unknown'}</p>
                        <p><strong>Message:</strong> ${error.response?.data?.message || error.message}</p>
                        <pre>${JSON.stringify(error.response?.data || error.message, null, 2)}</pre>
                    </div>
                `;
                
                updateStatus('Erreur lors du test du solde', 'error');
            }
        }
        
        async function testTopUp() {
            const resultDiv = document.getElementById('topup-result');
            
            try {
                updateStatus('Test de recharge en cours...', 'info');
                
                const payload = {
                    amount_xaf: 1000,
                    phone: '237 6XX XX XX XX',
                    message: 'Test de recharge'
                };
                
                const response = await axios.post('/wallet/topup', payload);
                
                resultDiv.innerHTML = `
                    <div style="background: #f0f8ff; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <h4>✅ Succès!</h4>
                        <p><strong>Message:</strong> ${response.data.message}</p>
                        <p><strong>Transaction ID:</strong> ${response.data.data?.transaction_id}</p>
                        <p><strong>URL de redirection:</strong> ${response.data.data?.redirect_url || 'N/A'}</p>
                        <pre>${JSON.stringify(response.data, null, 2)}</pre>
                    </div>
                `;
                
                updateStatus('Test de recharge réussi!', 'success');
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #ffe6e6; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <h4>❌ Erreur!</h4>
                        <p><strong>Status:</strong> ${error.response?.status || 'Unknown'}</p>
                        <p><strong>Message:</strong> ${error.response?.data?.message || error.message}</p>
                        <pre>${JSON.stringify(error.response?.data || error.message, null, 2)}</pre>
                    </div>
                `;
                
                updateStatus('Erreur lors du test de recharge', 'error');
            }
        }
        
        // Test de connectivité au démarrage
        window.onload = function() {
            updateStatus('Chargement de la page de test...', 'info');
            
            // Vérifier la connectivité API
            axios.get('/trending')
                .then(() => {
                    updateStatus('✅ Serveur API accessible! Vous pouvez tester les fonctionnalités.', 'success');
                })
                .catch(() => {
                    updateStatus('❌ Serveur API non accessible. Assurez-vous que Laravel tourne sur http://127.0.0.1:8000', 'error');
                });
        };
    </script>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 10px 0; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a9c; }
        h1, h2 { color: #333; }
    </style>
</body>
</html>