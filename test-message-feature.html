<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Message Feature</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #4338ca;
        }
        .info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .code {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #d1d5db;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de la fonctionnalit√© de message avec informations produit</h1>

    <div class="test-section">
        <h2>üìã Description de la fonctionnalit√©</h2>
        <p>Cette fonctionnalit√© permet d'initier une conversation avec le vendeur d'un produit en incluant automatiquement :</p>
        <ul>
            <li>‚úÖ L'image du produit</li>
            <li>‚úÖ Le titre du produit</li>
            <li>‚úÖ La description du produit</li>
            <li>‚úÖ Le prix du produit</li>
            <li>‚úÖ Un lien vers le produit</li>
            <li>‚úÖ Un bouton pour pr√©-remplir le message</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîó Test des URLs</h2>
        <p>Voici les URLs de test pour v√©rifier la fonctionnalit√© :</p>

        <div class="info">
            <strong>URL de base :</strong> <code>http://127.0.0.1:8000/messages</code>
        </div>

        <h3>Test avec produit :</h3>
        <a href="http://127.0.0.1:8000/messages?user=1&product=1&productInfo=%7B%22id%22%3A1%2C%22title%22%3A%22iPhone%2014%20Pro%22%2C%22description%22%3A%22iPhone%2014%20Pro%20en%20excellent%20√©tat%2C%20jamais%20utilis√©%22%2C%22price%22%3A899%2C%22image%22%3A%22http%3A%2F%2F127.0.0.1%3A8000%2Fstorage%2Fproducts%2Fiphone14pro.jpg%22%2C%22url%22%3A%22http%3A%2F2F127.0.0.1%3A8000%2Fproducts%2F1%22%7D" class="button">
            üß™ Tester avec iPhone 14 Pro
        </a>

        <h3>Test sans produit :</h3>
        <a href="http://127.0.0.1:8000/messages?user=1" class="button">
            üß™ Tester sans produit
        </a>
    </div>

    <div class="test-section">
        <h2>üîß Code impl√©ment√©</h2>

        <h3>1. Modification de ProductDetail.vue :</h3>
        <div class="code">
// Dans la fonction startConversation()
const productInfo = {
  id: product.value.id,
  title: product.value.title,
  description: product.value.description,
  price: product.value.price,
  image: product.value.main_image_url,
  url: `${window.location.origin}/products/${product.value.id}`
}

const encodedProductInfo = encodeURIComponent(JSON.stringify(productInfo))
router.push(`/messages?user=${product.value.user_id}&product=${product.value.id}&productInfo=${encodedProductInfo}`)
        </div>

        <h3>2. Modification de Messages.vue :</h3>
        <div class="code">
// Ajout de productInfo dans startTarget
const startTarget = ref({ userId: null, productId: null, productInfo: null })

// Fonction de pr√©-remplissage
function prefillProductMessage() {
  if (!startTarget.value.productInfo) return

  const product = startTarget.value.productInfo
  const message = `Bonjour ! Je suis int√©ress√©(e) par votre produit "${product.title}" au prix de ${formatPrice(product.price)}.

${product.description ? `Description : ${product.description}` : ''}

Pouvez-vous me donner plus d'informations ?`

  compose.value = message.trim()
}
        </div>
    </div>

    <div class="test-section">
        <h2>üì± Comment tester</h2>
        <ol>
            <li>Allez sur la page d'un produit : <code>http://127.0.0.1:8000/products/1</code></li>
            <li>Cliquez sur le bouton "Message"</li>
            <li>Vous serez redirig√© vers la page des messages avec les infos du produit</li>
            <li>Cliquez sur "Pr√©-remplir avec les infos du produit" pour g√©n√©rer un message automatique</li>
            <li>Modifiez le message si n√©cessaire et envoyez-le</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üêõ D√©pannage</h2>
        <p>Si la fonctionnalit√© ne fonctionne pas :</p>
        <ul>
            <li>V√©rifiez que le serveur Laravel est d√©marr√© sur le port 8000</li>
            <li>V√©rifiez que vous √™tes connect√© √† l'application</li>
            <li>Ouvrez la console du navigateur pour voir les erreurs</li>
            <li>V√©rifiez que les routes API fonctionnent</li>
        </ul>
    </div>

    <script>
        // Fonction pour tester la g√©n√©ration d'URL
        function testUrlGeneration() {
            const productInfo = {
                id: 1,
                title: "iPhone 14 Pro",
                description: "iPhone 14 Pro en excellent √©tat, jamais utilis√©",
                price: 899,
                image: "http://127.0.0.1:8000/storage/products/iphone14pro.jpg",
                url: "http://127.0.0.1:8000/products/1"
            };

            const encoded = encodeURIComponent(JSON.stringify(productInfo));
            const url = `http://127.0.0.1:8000/messages?user=1&product=1&productInfo=${encoded}`;

            console.log('URL g√©n√©r√©e:', url);
            console.log('ProductInfo:', productInfo);

            // Ouvrir dans un nouvel onglet
            window.open(url, '_blank');
        }

        // Ajouter un bouton de test
        document.addEventListener('DOMContentLoaded', function() {
            const testButton = document.createElement('button');
            testButton.textContent = 'üß™ Tester la g√©n√©ration d\'URL';
            testButton.className = 'button';
            testButton.onclick = testUrlGeneration;

            document.querySelector('.test-section:last-child').appendChild(testButton);
        });
    </script>
</body>
</html>
